# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ EFT Helper Bot

## –û–±–∑–æ—Ä

EFT Helper –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (Layered Architecture)** –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —É–ø—Ä–æ—â–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

## üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ª–æ—ë–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Presentation Layer             ‚îÇ
‚îÇ      (handlers/)                    ‚îÇ
‚îÇ  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è   ‚îÇ
‚îÇ  - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Business Logic Layer           ‚îÇ
‚îÇ      (services/)                    ‚îÇ
‚îÇ  - –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞                   ‚îÇ
‚îÇ  - –í–∞–ª–∏–¥–∞—Ü–∏—è                        ‚îÇ
‚îÇ  - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Data Access Layer              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  database/   ‚îÇ ‚îÇ api_clients/ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  (SQLite)    ‚îÇ ‚îÇ (tarkov.dev) ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã

### 1. **Separation of Concerns (–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏)**

–ö–∞–∂–¥—ã–π —Å–ª–æ–π –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ —Å–≤–æ—é —Ñ—É–Ω–∫—Ü–∏—é:

- **Handlers**: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- **Services**: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- **Database/API**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### 2. **Dependency Injection**

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ middleware:

```python
# –í main.py
@dp.update.outer_middleware()
async def inject_services(handler, event, data):
    data["weapon_service"] = self.weapon_service
    data["build_service"] = self.build_service
    # ...
```

### 3. **Single Responsibility Principle**

–ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å/–º–æ–¥—É–ª—å –∏–º–µ–µ—Ç –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:

- `TarkovAPIClient` - —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å API
- `WeaponService` - —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞ –æ—Ä—É–∂–∏—è
- `UserService` - —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 4. **Don't Repeat Yourself (DRY)**

–í—Å—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ —Å–µ—Ä–≤–∏—Å—ã:

```python
# –í–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–∞–∂–¥–æ–º handler:
user = await db.get_or_create_user(user_id)

# –ò—Å–ø–æ–ª—å–∑—É–µ–º service:
user = await user_service.get_or_create_user(user_id)
```

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### `main.py` - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞

```python
class BotApplication:
    def __init__(self):
        self.db = Database()
        self.api_client = TarkovAPIClient()
        self.weapon_service = WeaponService(self.db, self.api_client)
        # ...
```

### `api_clients/` - –í–Ω–µ—à–Ω–∏–µ API

**–ü—Ä–∞–≤–∏–ª–æ**: –í–°–ï –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω–µ—à–Ω–∏–º API –∏–¥—É—Ç –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ –∫–ª–∏–µ–Ω—Ç—ã.

```python
class TarkovAPIClient:
    async def get_all_weapons()
    async def get_all_traders()
    async def get_all_mods()
    # –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### `services/` - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

**–ü—Ä–∞–≤–∏–ª–æ**: –í—Å—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö, –ù–ï –≤ handlers.

```python
class WeaponService:
    async def search_weapons(query, language)
    async def get_weapons_by_category(category)
    async def get_weapons_by_tier(tier)

class BuildService:
    async def get_random_build()
    async def get_builds_for_weapon(weapon_id)
    async def get_builds_by_loyalty(trader_levels)

class UserService:
    async def get_or_create_user(user_id)
    async def update_language(user_id, language)
    async def update_trader_levels(user_id, levels)

class SyncService:
    async def sync_all()
    async def sync_weapons()
    async def sync_traders()
    async def sync_modules()
```

### `handlers/` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥

**–ü—Ä–∞–≤–∏–ª–æ**: –¢–æ–ª—å–∫–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è, –Ω–∏–∫–∞–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

```python
@router.message(Command("start"))
async def cmd_start(message, user_service):
    user = await user_service.get_or_create_user(message.from_user.id)
    await message.answer(get_text("welcome", user.language))
```

### `database/` - –†–∞–±–æ—Ç–∞ —Å –ë–î

```python
class Database:
    # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
    async def get_weapon_by_id(weapon_id)
    async def search_weapons(query)
    # ...
```

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä: –ü–æ–∏—Å–∫ –æ—Ä—É–∂–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /search
    ‚Üì
Handler (search.py)
    ‚Üì
user_service.get_or_create_user()
    ‚Üì
weapon_service.search_weapons(query)
    ‚Üì
database.search_weapons()
    ‚Üì
–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí Handler ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```

### –ü—Ä–∏–º–µ—Ä: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å API

```
–ö–æ–º–∞–Ω–¥–∞ ‚Üí sync_data.py
    ‚Üì
SyncService.sync_all()
    ‚Üì
api_client.get_all_weapons()
    ‚Üì
database.save_weapons()
    ‚Üì
–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω
```

## üé® –ü–∞—Ç—Ç–µ—Ä–Ω—ã

### Repository Pattern (—á–µ—Ä–µ–∑ Database)

```python
# Database –∫–ª–∞—Å—Å –¥–µ–π—Å—Ç–≤—É–µ—Ç –∫–∞–∫ Repository
db = Database()
weapons = await db.get_all_weapons()
```

### Service Layer Pattern

```python
# –°–µ—Ä–≤–∏—Å—ã –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
weapon_service = WeaponService(db, api_client)
weapons = await weapon_service.get_weapons_by_category(category)
```

### Dependency Injection

```python
# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–Ω–∂–µ–∫—Ç—è—Ç—Å—è —á–µ—Ä–µ–∑ middleware
async def handler(message, weapon_service, user_service):
    # –°–µ—Ä–≤–∏—Å—ã —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã
```

### Singleton (API Client)

```python
# –û–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä TarkovAPIClient –Ω–∞ –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
api_client = TarkovAPIClient()
```

## üö´ –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã (—á–µ–≥–æ –∏–∑–±–µ–≥–∞—Ç—å)

### ‚ùå –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ handlers

```python
# –ü–õ–û–•–û
async def handler(message, db):
    weapons = await db.get_all_weapons()
    filtered = [w for w in weapons if w.tier == "S"]  # –õ–æ–≥–∏–∫–∞ –≤ handler!
    sorted_weapons = sorted(filtered, key=lambda x: x.price)  # –ï—â—ë –ª–æ–≥–∏–∫–∞!
```

```python
# –•–û–†–û–®–û
async def handler(message, weapon_service):
    weapons = await weapon_service.get_top_tier_weapons()  # –õ–æ–≥–∏–∫–∞ –≤ service
```

### ‚ùå –ü—Ä—è–º—ã–µ API –≤—ã–∑–æ–≤—ã –∏–∑ handlers

```python
# –ü–õ–û–•–û
async def handler(message):
    async with aiohttp.ClientSession() as session:
        await session.get("https://api.tarkov.dev/...")  # –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤!
```

```python
# –•–û–†–û–®–û
async def handler(message, api_client):
    data = await api_client.get_all_weapons()  # –ß–µ—Ä–µ–∑ –∫–ª–∏–µ–Ω—Ç
```

### ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

```python
# –ü–õ–û–•–û - –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º handler
user = await db.get_or_create_user(user_id)
```

```python
# –•–û–†–û–®–û - —á–µ—Ä–µ–∑ service
user = await user_service.get_or_create_user(user_id)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–æ—â–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
# –¢–µ—Å—Ç service (mock database –∏ API)
async def test_weapon_service():
    mock_db = MockDatabase()
    mock_api = MockAPIClient()
    service = WeaponService(mock_db, mock_api)
    
    result = await service.search_weapons("AK-74")
    assert len(result) > 0
```

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞:

1. **–ù–æ–≤—ã–π API –∏—Å—Ç–æ—á–Ω–∏–∫**: —Å–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç –≤ `api_clients/`
2. **–ù–æ–≤–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞**: —Å–æ–∑–¥–∞—Ç—å service –≤ `services/`
3. **–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞**: —Å–æ–∑–¥–∞—Ç—å handler –≤ `handlers/`

### –ü—Ä–∏–º–µ—Ä: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞

```python
# 1. api_clients/flea_market_client.py
class FleaMarketClient:
    async def get_prices()

# 2. services/market_service.py
class MarketService:
    async def find_best_deals()

# 3. handlers/market.py
@router.message(Command("market"))
async def show_market(message, market_service):
    deals = await market_service.find_best_deals()
```

## üîç –û—Ç–ª–∞–¥–∫–∞

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ:

```python
# Handler
logger.info(f"User {user_id} requested weapon search")

# Service
logger.debug(f"Searching weapons with query: {query}")

# API Client
logger.info(f"Fetched {len(weapons)} weapons from API")
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã**: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–µ–¥—É–µ—Ç SOLID
- **Clean Architecture**: –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–∞ Clean Architecture
- **Domain-Driven Design**: —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç domain –ª–æ–≥–∏–∫—É
